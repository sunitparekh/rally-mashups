<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Scrum Board Mashup by sUnit, ThoughtWorks Inc.</title>

    <script charset="utf-8" src="/slm/pack/combined.js.h-1314550004.pack" type="text/javascript"></script>
    <script type="text/javascript" src="/slm/js-lib/dojo/1.3.1/dojo/dojo.js"></script>
    <script type="text/javascript" src="/slm/mashup/1.14/js/batch-toolkit.js"></script>
    <script type="text/javascript" src="/slm/mashup/1.14/js/utilities.js"></script>
    <script type="text/javascript" src="/slm/mashup/1.14/js/dropdown.js"></script>

    <link rel="stylesheet" type="text/css" href="http://real.us.yimg.com/lib/yui/3.0.0/build/cssreset/reset-min.css"/>
    <script src="http://yui.yahooapis.com/3.0.0/build/yui/yui-min.js"></script>

    <style type="text/css">
        @css@
    </style>
    <script type="text/javascript">
        @javascript@
    </script>
</head>
<body>

@layout@

<script type="text/javascript">
    var YahooUI = YUI().use('mashups-swimlane','mashups-card','mashups-service', function (Y) {
        var service = null;
        var swimlanes = null;                                   
        var filterType = RALLY.Mashup.ITERATION;
        var flashMessage = Y.one("#flash-message");

        function initPage() {
            service = new Y.Mashups.Service();
            flashMessage.set("innerHTML","Please wait... loading swimlanes"); flashMessage.removeClass("hide");
            Y.Mashups.ScrumBoard.loadSwimlaneBoard();
            service.loadFilter(filterType, Y.Mashups.ScrumBoard.refreshCardsOnBoard);
        }

        Y.namespace('Mashups.ScrumBoard');

        Y.Mashups.ScrumBoard.loadSwimlaneBoard = function() {
            swimlanes = service.findKanbanStatesAsSwimlanes();
            swimlanes.set('service',service);
            swimlanes.renderSwimlanes();
        };

        Y.Mashups.ScrumBoard.refreshCardsOnBoard = function() {
            flashMessage.set("innerHTML","Please wait... loading cards");  flashMessage.removeClass("hide");
            var cards = service.findCardsByFilter(filterType, Y.Mashups.ScrumBoard.renderCards);
        };

        Y.Mashups.ScrumBoard.renderCards = function(cards) {
            cards.sortByRank();
            swimlanes.renderCards(cards);
            Y.one("#flash-message").addClass("hide");
        };

        initPage();
    });

    

    function refreshWindow(url, cardNumber, cardTitle, flag1, flag2, flag3){
        YahooUI.Mashups.ScrumBoard.refreshCardsOnBoard();
    }
    
</script>
</body>
</html>